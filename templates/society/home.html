{% extends 'society/base.html' %}
{% load static %}

{% block extra_css %}
<style>
/* Premium Stat Cards */
.block-card {
    transition: transform 0.3s, box-shadow 0.4s;
    cursor: pointer;
    border-radius: 15px;
    background: #ffffff;
    border-left-width: 5px !important;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

/* Card Color Combinations */
.block-card.color-1 { border-left-color: #0d6efd; background: linear-gradient(145deg, #e0f0ff, #ffffff);}
.block-card.color-2 { border-left-color: #6610f2; background: linear-gradient(145deg, #f3e5ff, #ffffff);}
.block-card.color-3 { border-left-color: #198754; background: linear-gradient(145deg, #e6f8f0, #ffffff);}
.block-card.color-4 { border-left-color: #fd7e14; background: linear-gradient(145deg, #fff4e6, #ffffff);}

.block-card:hover {
    transform: translateY(-5px) scale(1.03);
    box-shadow: 0 12px 25px rgba(0,0,0,0.2);
}

/* Card Text Shadow */
.card-body h4, .card-body p {
    text-shadow: 1px 1px 2px rgba(0,0,0,0.15);
}

/* Gradient Buttons */
.btn-gradient {
    background: linear-gradient(90deg, #0d6efd, #6610f2);
    color: #fff;
    border-radius: 50px;
    transition: transform 0.2s, box-shadow 0.3s;
}
.btn-gradient:hover {
    transform: scale(1.05);
    box-shadow: 0 8px 20px rgba(0,0,0,0.25);
}

/* Add Block Form */
.card form input {
    border-radius: 50px;
    transition: box-shadow 0.3s;
}
.card form input:focus {
    box-shadow: 0 4px 12px rgba(13,110,253,0.3);
}

/* View Block Button */
.view-block {
    transition: transform 0.2s, box-shadow 0.3s;
}
.view-block:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 15px rgba(0,0,0,0.2);
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .block-card { margin-bottom: 20px; }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <h2 class="mb-5 text-center fw-bold text-primary">üè¢ Blocks Overview</h2>

  <!-- Add Block Form -->
  <div class="card block-card mb-3">
    <div class="card-body">
      <h5 class="card-title fw-bold">Add New Block</h5>
      <form method="POST" class="row g-3 align-items-center">
        {% csrf_token %}
        <div class="col-md-10">
          <input type="text" name="name" class="form-control form-control-lg" placeholder="Block Name" required>
        </div>
        <div class="col-md-2 d-grid">
          <button type="submit" class="btn btn-primary btn-lg">Add Block</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Blocks Overview -->
  <div class="row g-4">
    {% for block in blocks|dictsort:"name" %}
      {% comment %} Cycle colors based on loop index {% endcomment %}
    
      <div class="col-xl-3 col-md-6">
        <div class="card stat-card block-card {{ card_color }}">
          <div class="card-body d-flex justify-content-between align-items-center">
            <div>
              <h4 class="card-title fw-semibold text-secondary mb-1">{{ block.name }}</h4>
              <p class="card-text text-muted mb-2">{{ block.resident_count|default:"0" }} residents</p>
              <button class="btn view-block btn-primary btn-sm mt-2" data-block-id="{{ block.id }}">Open</button>
            </div>
            <div class="text-primary fs-1">
              <i class="fas fa-users"></i>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <p class="text-muted text-center mt-4">No blocks available.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.querySelectorAll('.view-block').forEach(btn => {
  btn.addEventListener('click', function() {
    const blockId = this.dataset.blockId;
    const loggedIn = {{ user.is_authenticated|yesno:"true,false" }};
    
    if (!loggedIn) {
      alert('Please login first');
      return;
    }
    if (blockId) {
      window.location.href = '/block/' + blockId + '/';
    } else {
      alert('Block not available');
    }
  });
});
</script>
{% endblock %}
